<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <style type="text/css">
    body {
      margin: 0;
      padding: 20px;
    }
  </style>
  <title>Geo Location</title>
</head>

<body>
  <div id="out"></div>
  <script>
    window.onload = function () {
      geoFindMe();
    };

    function getTileImage(lat, lon, zoom) {
      const xTile = parseInt(Math.floor((lon + 180) / 360 * (1 << zoom)));
      const yTile = parseInt(Math.floor((1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) /
        Math.PI) / 2 * (1 << zoom)));
      return "https://cyberjapandata.gsi.go.jp/xyz/pale/" + zoom + "/" + xTile + "/" + yTile + ".png";
    }

    function geoFindMe() {
      var output = document.getElementById("out");

      if (!navigator.geolocation) {
        output.innerHTML = "<p>Geolocation is not supported by your browser</p>";
        return;
      }

      function geo_success(position) {
        var latitude = position.coords.latitude;
        var longitude = position.coords.longitude;

        output.innerHTML = '<p>Latitude is ' + latitude + '° <br>Longitude is ' + longitude + '°</p>';

        var img = new Image();
        img.src = getTileImage(latitude, longitude, 16);

        output.appendChild(img);
      }

      function geo_error(error) {
        output.innerHTML = 'ERROR(' + error.code + '): ' + error.message;
      }

      output.innerHTML = "<p>Locating…</p>";

      // とりあえず低精度で速やかに測位
      navigator.geolocation.getCurrentPosition(geo_success, geo_error);

      // GPS等による高精度測位を非同期的に継続
      var geo_options = {
        enableHighAccuracy: true,
        maximumAge: 30000,
        timeout: 27000
      };
      var watchID = navigator.geolocation.watchPosition(function (position) {
        do_something(position.coords.latitude, position.coords.longitude);
      });
      // navigator.geolocation.clearWatch(watchID);
    }
  </script>

</body>

</html>